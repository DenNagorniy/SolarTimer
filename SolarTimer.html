<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>SolarTimer — Ваш идеальный световой день</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f9fafc;
            color: #222;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 380px;
            margin: 36px auto 0 auto;
            background: none;
            padding: 0 6px;
            text-align: center;
        }
        .header {
            font-size: 2.2em;
            font-weight: 800;
            letter-spacing: 1px;
            margin-bottom: 18px;
            margin-top: 10px;
            color: #2861e1;
        }
        .inputs-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 18px;
        }
        .inputs-row {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 8px;
            justify-content: center;
            width: 100%;
        }
        label {
            min-width: 62px;
            text-align: right;
            font-weight: 500;
        }
        input[type="text"], input[type="number"], input[type="date"] {
            padding: 7px 8px;
            border: 1px solid #e3e8f0;
            border-radius: 7px;
            font-size: 1.08em;
            background: #fff;
            transition: border .2s;
            text-align: center;
        }
        input[type="text"]:focus, input[type="number"]:focus, input[type="date"]:focus {
            border: 1.5px solid #3b82f6;
            outline: none;
        }
        .hidden {
            display: none;
        }
        .show-coords-btn {
            background: none;
            border: none;
            color: #3b82f6;
            cursor: pointer;
            font-size: 1em;
            margin-bottom: 8px;
            margin-top: -6px;
            text-decoration: underline;
        }
.button-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1px;
    margin-bottom: 6px;
}
.main-btn {
    width: 180px;
    background: #2861e1;
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 12px 0;
    font-size: 1.15em;
    font-weight: 600;
    box-shadow: 0 3px 14px #2859e120;
    cursor: pointer;
    transition: background .2s;
    letter-spacing: 0.02em;
}
.main-btn:hover { background: #174bb6; }

        button:not(.show-coords-btn) {
            background: #2861e1;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 32px;
            font-size: 1.15em;
            font-weight: 600;
            margin: 12px 0 14px 0;
            cursor: pointer;
            transition: background .2s;
            box-shadow: 0 3px 14px #2859e120;
        }
        button:not(.show-coords-btn):hover { background: #174bb6; }
        .info {
            background: #f4f8ff;
            border-radius: 13px;
            padding: 19px 10px;
            margin: 0 0 18px 0;
            box-shadow: 0 2px 10px #e3e8f061;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .label-value { margin: 4px 0; font-size: 1.13em;}
        .now-block {
            background: #fff;
            border-radius: 13px;
            padding: 13px 7px 8px 7px;
            box-shadow: 0 2px 8px #e3e8f021;
            margin-bottom: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        @media (max-width: 500px) {
            .container { max-width: 100vw; }
            .header { font-size: 1.2em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">SolarTimer☀️</div>
        <div class="inputs-group">
            <div class="inputs-row" style="justify-content: center;">
                <label for="city">Город:</label>
                <input type="text" id="city" value="">
            </div>
            <button class="show-coords-btn" onclick="toggleCoords()">Показать/скрыть координаты</button>
            <div class="inputs-row hidden" id="coords-row">
                <label for="lat">Широта:</label>
                <input type="number" id="lat" step="0.0001">
                <label for="lon">Долгота:</label>
                <input type="number" id="lon" step="0.0001">
            </div>
          <!-- ... -->
<div class="inputs-row" style="justify-content: center;">
    <label for="date">Дата:</label>
    <input type="date" id="date">
</div>
<div class="button-group">
    <button type="button" class="main-btn" onclick="autoDetectLocationAndCity()">Геопозиция</button>
    <button type="button" class="main-btn" onclick="updateTimes()">Рассчитать</button>
</div>
        <div class="info">
            <div class="label-value" id="sunrise">Восход: --:--</div>
            <div class="label-value" id="sunset">Закат: --:--</div>
            <div class="label-value" id="day-length">Длина дня: -- мин</div>
            <div class="label-value" id="night-length">Длина ночи: -- мин</div>
            <div class="label-value" id="day-hour">Световой час: -- мин</div>
            <div class="label-value" id="night-hour">Ночной час: -- мин</div>
        </div>
        <div class="now-block">
            <div class="label-value">Текущее время: <span id="current-time">--:--</span></div>
            <div class="label-value" id="solar-time">Световое время: --</div>
        </div>
    </div>
<script>
document.getElementById('date').valueAsDate = new Date();

function toggleCoords() {
    document.getElementById('coords-row').classList.toggle('hidden');
}

autoDetectLocationAndCity();
async function autoDetectLocationAndCity() {
    if (!navigator.geolocation) {
        alert("Ваш браузер не поддерживает геолокацию.");
        return;
    }
    navigator.geolocation.getCurrentPosition(async function(pos){
        const lat = Number(pos.coords.latitude).toFixed(4);
        const lon = Number(pos.coords.longitude).toFixed(4);
        document.getElementById('lat').value = lat;
        document.getElementById('lon').value = lon;
        // Находим город через OSM
        let resp = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&accept-language=ru`);
        let data = await resp.json();
        let city = data.address.city || data.address.town || data.address.village || data.address.state || data.display_name || '';
        document.getElementById('city').value = city;
        updateTimes();
    }, function(){
        alert("Не удалось получить ваше местоположение.");
    });
}

async function cityToCoords() {
    let city = document.getElementById('city').value.trim();
    if (!city) return;
    let resp = await fetch(`https://nominatim.openstreetmap.org/search?city=${encodeURIComponent(city)}&format=json&limit=1&accept-language=ru`);
    let data = await resp.json();
    if (data && data[0]) {
        document.getElementById('lat').value = Number(data[0].lat).toFixed(4);
        document.getElementById('lon').value = Number(data[0].lon).toFixed(4);
        updateTimes();
    }
}
async function coordsToCity() {
    let lat = document.getElementById('lat').value;
    let lon = document.getElementById('lon').value;
    if (!lat || !lon) return;
    let resp = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&accept-language=ru`);
    let data = await resp.json();
    let city = data.address.city || data.address.town || data.address.village || data.address.state || data.display_name || '';
    document.getElementById('city').value = city;
    updateTimes();
}
document.getElementById('city').addEventListener('blur', cityToCoords);
document.getElementById('lat').addEventListener('blur', coordsToCity);
document.getElementById('lon').addEventListener('blur', coordsToCity);

async function updateTimes() {
    let lat = document.getElementById('lat').value;
    let lon = document.getElementById('lon').value;
    let date = document.getElementById('date').value;
    if (!lat || !lon || !date) return;
    let sunResp = await fetch(`https://api.sunrise-sunset.org/json?lat=${lat}&lng=${lon}&date=${date}&formatted=0`);
    let sunData = await sunResp.json();
    if (sunData.status !== "OK") {
        document.getElementById('sunrise').textContent = "Восход: ошибка API";
        document.getElementById('sunset').textContent = "Закат: ошибка API";
        return;
    }
    const sunrise = new Date(sunData.results.sunrise);
    const sunset = new Date(sunData.results.sunset);
    function pad(n) { return n.toString().padStart(2,'0'); }
    document.getElementById('sunrise').textContent = `Восход: ${pad(sunrise.getHours())}:${pad(sunrise.getMinutes())}`;
    document.getElementById('sunset').textContent  = `Закат: ${pad(sunset.getHours())}:${pad(sunset.getMinutes())}`;
    let sunriseMins = sunrise.getHours() * 60 + sunrise.getMinutes();
    let sunsetMins = sunset.getHours() * 60 + sunset.getMinutes();
    let dayLength = sunsetMins - sunriseMins;
    let nightLength = 1440 - dayLength;
    let dayHour = Math.round(dayLength / 12);
    let nightHour = Math.round(nightLength / 12);
    document.getElementById('day-length').textContent = `Длина дня: ${dayLength} мин`;
    document.getElementById('night-length').textContent = `Длина ночи: ${nightLength} мин`;
    document.getElementById('day-hour').textContent = `Световой час: ${dayHour} мин`;
    document.getElementById('night-hour').textContent = `Ночной час: ${nightHour} мин`;
    window.sunData = { sunriseMins, sunsetMins, dayLength, nightLength, dayHour, nightHour };
    updateCurrentTime();
}
function updateCurrentTime() {
    const now = new Date();
    document.getElementById('current-time').textContent = now.toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'});
    if (!window.sunData) return;
    let currentMins = now.getHours() * 60 + now.getMinutes();
    let solarTime = '--';
    if (currentMins >= window.sunData.sunriseMins && currentMins <= window.sunData.sunsetMins) {
        let minsSinceSunrise = currentMins - window.sunData.sunriseMins;
        let currentHour = Math.floor(minsSinceSunrise / window.sunData.dayHour) + 1;
        let minutesInHour = minsSinceSunrise % window.sunData.dayHour;
        solarTime = `${currentHour}:${minutesInHour.toString().padStart(2, '0')}`;
    } else {
        let minsSinceSunset = (currentMins > window.sunData.sunsetMins)
            ? (currentMins - window.sunData.sunsetMins)
            : (currentMins + 1440 - window.sunData.sunsetMins);
        let currentHour = Math.floor(minsSinceSunset / window.sunData.nightHour) + 1;
        let minutesInHour = minsSinceSunset % window.sunData.nightHour;
        solarTime = `${currentHour}:${minutesInHour.toString().padStart(2, '0')}`;
    }
    document.getElementById('solar-time').textContent = `Световое время: ${solarTime}`;
}
setInterval(updateCurrentTime, 1000);
</script>
</body>
</html>
